version: 0.2

phases:
  install:
    commands:
      - echo "Checking OS type..."
      - uname -a  # Print system details
      - echo "Installing dependencies..."
      
      # Use apt-get if the environment is Ubuntu-based
      - if [ -x "$(command -v apt-get)" ]; then apt-get update -y && apt-get install -y docker.io; fi
      
      # Use yum if the environment is Amazon Linux-based
      - if [ -x "$(command -v yum)" ]; then yum update -y && yum install -y docker; fi

      - service docker start

  pre_build:
    commands:
      - echo "Logging in to Amazon ECR..."
      - aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin 755694651723.dkr.ecr.us-west-2.amazonaws.com

  build:
    commands:
      - echo "Building Docker image..."
      - docker build -t project-app-container .
      - docker tag project-app-container:latest 755694651723.dkr.ecr.us-west-2.amazonaws.com/project-app-container:latest

  post_build:
    commands:
      - echo "Pushing Docker image..."
      - docker push 755694651723.dkr.ecr.us-west-2.amazonaws.com/project-app-container
      - echo "Build completed successfully!"
